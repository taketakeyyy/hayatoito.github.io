<!DOCTYPE html>
<html>
  <head>
    <title>Web のつくりかた: ソフトウェアエンジニアリングと雰囲気で理解する Web 標準とブラウザのつくりかた — hayato.io</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="twitter:card"  content="summary" />
    <meta property="twitter:title" content="Web のつくりかた: ソフトウェアエンジニアリングと雰囲気で理解する Web 標準とブラウザのつくりかた — hayato.io"/>
    
    <link rel="canonical" href="https://hayato.io/2017/making-web/"/>
    
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <script defer src="https://use.fontawesome.com/releases/v5.0.6/js/all.js"></script>
    <link rel="author" href="http://www.hatena.ne.jp/hayatoito1/" />
    <link href="https://hayato.io/site.css" rel="stylesheet">
    <link id="favicon" href="https://hayato.io/favicon.ico" rel="shortcut icon">
    <link href="https://hayato.io/feed.xml" rel="alternate"
          title="hayato.io" type="application/atom+xml">
    
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-195971-6"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-195971-6');
    </script>
    
  </head>
  <body data-spy="scroll" data-target="#toc" data-offset="50">
    
    <nav class="navbar navbar-expand-sm navbar-light bg-light" style="background-color: #fff !important;">
      <a class="navbar-brand" href="https://hayato.io/">hayato.io</a>
      <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavDropdown" aria-controls="navbarNavDropdown" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNavDropdown">
        <ul class="navbar-nav">
          <li class="nav-item active">
            <a class="nav-link" href="https://hayato.io/archive/">Archive</a>
          </li>
        </ul>
      </div>
    </nav>
    <div class="container">
      <div class="row">
        
        <div class="col col-xl-9">
        
          
<article>
  <header class="page-header">
    <h1 id="top" class="site-article-title">
      <a href="https://hayato.io/2017/making-web/" class="self-link">
        Web のつくりかた: ソフトウェアエンジニアリングと雰囲気で理解する Web 標準とブラウザのつくりかた
      </a>
    </h1>
    
    
    <div class="text-right">
      <time datetime="2017-12-25">
        2017-12-25
      </time>
    </div>
    
    
  </header>
  <div class="article-content">
    <p>この記事は
<a href="https://qiita.com/advent-calendar/2017/chromium">Chromium Browser アドベントカレンダー</a>
25 日目の記事です。</p>
<p>昨日の<a href="/2017/dom/">記事</a>では主にデータ構造とアルゴリズムに注目しましたが、この記事では、実際に行われているソフトウェアエンジニアリングを通じて上流工程 (Web 標準の策定) から下流工程 (ブラウザの開発)まで Web のつくりかたを雰囲気で理解するのを目的としています。</p>
<p>この記事の想定読者は一般の Web 開発者やソフトウェアエンジニアです。</p>
<p>記事へのフィードバック・Typo などを発見しましたら、<a href="https://github.com/hayatoito/hayatoito.github.io/issues?q=is%3Aopen+is%3Aissue">GitHub Issue</a>
の方へお願いします。</p>
<h1 id="web"><a class="self-link" href="#web">Web プラットフォーム</a></h1>
<p>Web プラットフォームは極めてユーザー数が多いプラットフォームです。Web で情報を得ている人や Web で情報を発信をしている人などもユーザーとみなせば、極端な言い方をすれば地球上のほぼ全員がこのプラットフォームのエコシステムの一員です。</p>
<p><img src="./web-triangle.svg" alt="web triangle" /></p>
<p>Web 開発者の数はユーザーの数と比べればぐっと少ないです。ブラウザをつくっている人はもっと少ないです。</p>
<h2 id="web-web-standards"><a class="self-link" href="#web-web-standards">Web 標準 (Web Standards)</a></h2>
<p>Web プラットフォームは仕様と実装がわかれています。仕様に対して複数の実装（ブラウザ）があるのが大きな特徴のひとつです。</p>
<p>Web がどう動くべきかを記した「仕様」は「Web Standard」(Web 標準) と呼ばれています有名なところでは HTML の仕様である
<a href="https://html.spec.whatwg.org/">HTML Standard</a>、DOM の仕様である
<a href="https://dom.spec.whatwg.org/">DOM Standard</a> などが挙げられます。</p>
<h2 id="browser-vendor"><a class="self-link" href="#browser-vendor">ブラウザベンダ (Browser Vendor)</a></h2>
<p>Web 標準にもとづいて、その実装としてのブラウザをつくる組織・企業のことをブラウザベンダといいます。</p>
<p>メジャーなブラウザとしては、Chrome、Safari、Firefox、Edge などがあります。それぞれ、Google、Apple、Mozilla、Microsoft が主に開発しています。</p>
<p>Web 開発者は「実装が複数あることはわずらわしい」と考えるかもしれませんが、複数の実装があることこそが何より Web を Web 足らしめている大きな特徴です。ブラウザベンダ間の健全な競争こそがプラットフォームを進化させます。</p>
<h1 id="web-web"><a class="self-link" href="#web-web">Web のつくりかた: Web 標準編</a></h1>
<p>ここでは私が主に関わっている DOM Standard (Shadow DOM を含む) と HTML Standard
に絞ります。DOM Standard、HTML Standard ともに GitHub 上で管理されています。</p>
<h2 id="dom-standard"><a class="self-link" href="#dom-standard">DOM Standard</a></h2>
<ul>
<li>DOM 仕様: <a href="https://dom.spec.whatwg.org/">DOM Standard</a>
<ul>
<li>GitHub: <a href="https://github.com/whatwg/dom">whatwg/dom</a></li>
<li>Issues: <a href="https://github.com/whatwg/dom/issues">Open Issues</a></li>
<li>コミット: <a href="https://github.com/whatwg/dom/commits">whatawg/dom/commits</a></li>
<li>テスト:
<a href="https://github.com/w3c/web-platform-tests/tree/master/dom">web-platform-tests/dom</a>、<a href="https://github.com/w3c/web-platform-tests/tree/master/shadow-dom">web-platform-tests/shadow-dom</a></li>
</ul>
</li>
</ul>
<h2 id="html-standard"><a class="self-link" href="#html-standard">HTML Standard</a></h2>
<ul>
<li>HTML 仕様: <a href="https://html.spec.whatwg.org/">HTML Standard</a>
<ul>
<li>GitHub: <a href="https://github.com/whatwg/html">whatwg/html</a></li>
<li>Issues: <a href="https://github.com/whatwg/html/issues">Open Issues</a></li>
<li>コミット: <a href="https://github.com/whatwg/html/commits">whatawg/html/commits</a></li>
<li>テスト:
<a href="https://github.com/w3c/web-platform-tests/tree/master/html">web-platform-tests/html</a></li>
</ul>
</li>
</ul>
<div class="article-info">
Web 標準によって文化やプロセスが異なります。たとえば CSS は比較的伝統的な W3C のプロセスを重視している傾向が残っています。DOM や HTML は 主に WHATWG のブラウザベンダの代表者による話し合いと同意を重視しており極めて実践的です。
</div>
<h2 id="web-1"><a class="self-link" href="#web-1">Web 標準の更新のしかた</a></h2>
<p>基本的な流れは以下のとおりです。</p>
<ol>
<li>GitHub 上で Issue をあげる</li>
<li>Issee 上で議論をし関係者間で同意をとる</li>
<li>PR (Pull Request) を送る</li>
<li>必要に応じて テスト (Web Platorm Test) を書く</li>
<li>レビューを受けて Editor に Merge される</li>
</ol>
<p>通常のソフトウェア開発プロジェクトと大きな違いはありません。</p>
<h2 id="wontfix-close-issue"><a class="self-link" href="#wontfix-close-issue">WONTFIX / Close されやすい Issue</a></h2>
<p>Web 標準に貢献しているのはブラウザベンダの関係者が多いですが、基本的には誰でも参加できます。メジャーな JavaScript のフレームワーク・ライブラリの開発者たちが新しいアイデアや要望を出してくることも多いです。</p>
<p>ただし、以下のような Issue は 取り込まれることなくそのまま WONTFIX で Close される可能性が高いでしょう。</p>
<ul>
<li>
<p>具体的ではない</p>
<p>例: 「XX ができたらいいなー」</p>
<p>このような Issue は「具体的なアイデアは？」と求められるでしょう。またアイデアだけでは十分ではなく、具体的なプロセシング・モデルがきちんと定義されているのが望ましいです。議論が生産的になります。</p>
</li>
<li>
<p>ブラウザベンダが実装に関心がない</p>
<p>実装されることのない仕様は負債になります。このような Issue も Close されてしまうでしょう。ブラウザベンダが思わず実装したくなるような仕様を提案するとよいです。</p>
</li>
<li>
<p>Web を壊す</p>
<p>残念ながらほとんどの提案が後方互換性を壊すような提案です。ブラウザベンダは後方互換性を壊すような提案には極めて慎重です。よほどのことがないと反対されるでしょう。</p>
</li>
<li>
<p>実装が困難</p>
<p>現実的に実装が可能なアイデアでないと Close されるでしょう。これについてはブラウザベンダの人に聞くのがよいでしょう。</p>
</li>
<li>
<p>最初だけ議論が盛り上がる</p>
<p>これもよくあるパターンです。新しい Issue が上がった直後は議論が活発におこなわれますが、その後まったく関心がなくなるというのは、結局その問題を本当に解決したいとは誰も思っていないのです。</p>
</li>
</ul>
<p>「いきなり、Issue を上げるのはちょっと..」「そんなに具体的じゃないけど、いいアイデアを思いついた」そのようなときは直接 Web 標準 の GitHub に Issue をあげるのではなく、<a href="https://discourse.wicg.io/">WICG</a> (Web Platform Incubator Community
Group) をオススメします。こちらはより「よちよち歩き」なアイデアを議論するための場所です。</p>
<h2 id="a"><a class="self-link" href="#a">ブラウザベンダが気にするところ</a></h2>
<p>すべてのブラウザベンダの同意をとるのは大変です。簡単な修正は特に問題なく通ります。しかし、大きめな変更はブラウザベンダのその分野の代表者の同意をとる必要があります。私も含めてかんたんには説得されません。実装者が仕様の詳細を決めるにあたって気にすることを以下にあげます。</p>
<ul>
<li>
<p>本当に Web プラットフォームでネイティブにサポートする必要があるかどうか</p>
<p>新しいプリミティブとしてプラットフォームに追加する価値があるかどうかが問われます。 JavaScript のレイヤーで簡単に実現可能なマイナーなものに関してはまず通らないでしょう。逆に今まで JavaScript のレイヤーで行っていたものの、プラットフォームに追加することによって大幅にパフォーマンスが改善されることが期待されるならば通りやすいでしょう。ブラウザベンダはプラットフォームの速度のボトルネックとなっている古い API を追放したがっています。</p>
</li>
<li>
<p>ユースケースがクリアかどうか</p>
<p>間違いなくユースケースについては聞かれます。実際に Web 開発者が抱えている問題が解決される？</p>
</li>
</ul>
<p>また誰もが最初からほんとによい仕様かどうかは 100% 自信があるわけではありません。実際にブラウザ上で C++ で実装してみないとなんともいえない場合もよくあります。「とりあえず」実装してみてユーザーに使用してもらい、フィードバックを受けて改善していくといったフィードバックループはとても大事です。</p>
<h2 id="web-web-plaform-test"><a class="self-link" href="#web-web-plaform-test">Web プラットフォームテスト (Web Plaform Test)</a></h2>
<p>Web 標準を変更するときは同時にテスト (Web Platform Test) も書くことも要求されます。詳しくは <a href="https://github.com/w3c/web-platform-tests">web-platform-tests</a> を参照ください。テストは各ブラウザで共有されます。次のようなメリットがあります。</p>
<ul>
<li>
<p>ブラウザ間の互換性の向上</p>
</li>
<li>
<p>ブラウザベンダの負担の軽減。各ブラウザベンダが独自にテストを書く必要性がなくなります。</p>
</li>
<li>
<p>生きた仕様書</p>
<p>Web の仕様書を読んでも「いったいなにをいっているのかわからない」ということは多いでしょう。はっきりと動作が定義されたテストはコミュニケーションツールとしての役割を果たします。仕様の議論においても「具体的な動作がいまいちピンとこないです。ちょっとテストを書いてみてくれない？」とお願いされることは多いでしょう。</p>
</li>
</ul>
<p>「いきなり Web 標準に貢献するのはちょっと...」という人でもまずはテストから貢献するとよいでしょう。</p>
<h2 id="a-1"><a class="self-link" href="#a-1">名前の衝突 / 後方互換製を壊す恐れ</a></h2>
<p>新しい Web API や新しいエレメントを Web に入れるときは、その名前がすでに Web 上で広く使用されていないかどうかチェックする必要があります。たとえ「衝突する恐れのある名前を勝手に使用している行儀の悪い Web サイト」であろうと、既存の Web サイトを壊すわけにはいかないからです。</p>
<p>「Web を grep」 するには <a href="http://httparchive.org/">httparchive</a> などが使用できます。Top 1,000,000 サイトのアーカイブから検索できます。</p>
<p>例
(<a href="https://github.com/whatwg/dom/issues/510#issuecomment-330486945">whatwg/dom/issues/510</a>):</p>
<pre><code class="language-sql prettyprint"> SELECT page, count(*)
 FROM [httparchive:har.2017_09_01_chrome_requests_bodies]
 WHERE REGEXP_MATCH(body, r'&lt;shadowroot&gt;')
 GROUP BY page
</code></pre>
<h2 id="a-2"><a class="self-link" href="#a-2">いつまでたっても実装されない仕様の取り扱い</a></h2>
<p>仕様から削除します。仕様にアルゴリズムが載ったものの 10 年 たってもどこのブラウザも実装していないのなら、それは勇気をもって削除するべきです。削除の前に各ブラウザベンダの状況や意思は確認します。</p>
<p>逆に 2 つ以上のブラウザですでに実装されている API については削除したくてもしずらいです。しかし実はどちらも削除したがっているということも少なくなく「これ削除したいんだけど、どう？」と聞くと「あー、実は削除したかったんだよね。なーんだ、そう思っていたんだ。早くいってくれればいいのに！削除しましょう！」となることもあります。そのときは歩調を合わせて削除に向かいます。</p>
<h2 id="whatwg"><a class="self-link" href="#whatwg">WHATWG</a></h2>
<p>今月 WHATWG が <a href="https://blog.whatwg.org/working-mode-changes">IPR を更新</a> したため、ようやく Microsoft が WHATWG に参加できる見通しになりました。メジャーなブラウザベンダのなかではこれまで Microsoft だけが今まで特許ポリシーのため WHATWG に参加できませんでしたが、これでようやくすべてのメジャーブラウザが DOM や HTML については WHATWG で一緒に仕事をすることができるようになります。</p>
<p>個人的には Microsoft のためだけに DOM Standard とは別にメンテナンスしていた「<a href="https://w3c.github.io/webcomponents/spec/shadow/">Shadow DOM 仕様</a>」をこれで削除することが可能になりとても負担が減ります。</p>
<div class="article-info">
我々は W3C の DOM 仕様や HTML5 (HTML 5.1, HTML 5.2 など) 仕様には一切関わっていません。実際、私は W3C の DOM 仕様が Shadow DOM を取り入れようとしたとき、一時的に W3C DOM の Editor になってほしいと依頼されましたが、WHATWG にフォーカスするため丁重に依頼を断りました。
<p>HTML 5 仕様の意義については、W3C に尋ねてください。</p>
</div>
<h1 id="web-2"><a class="self-link" href="#web-2">Web のつくりかた: ブラウザ編</a></h1>
<p>さて Web 標準についてはもう十分でしょう。ここからは楽しい実装の話にうつりましょう。どんなに素晴らしい仕様も実装がなければなんの意味もありません。</p>
<p>この記事では Chrome のレンダリングエンジンである Blink における実装の話をします。</p>
<h2 id="web-api"><a class="self-link" href="#web-api">新機能の実装 / 新しい Web API をプラットフォームに追加する</a></h2>
<p>基本的な流れは以下のようになります。</p>
<ol>
<li>
<p>公開 ML
(<a href="https://groups.google.com/a/chromium.org/forum/#!forum/blink-dev">blink-dev</a>)
に &quot;Intent to implement: XXX&quot; メールを出す （例:
<a href="https://groups.google.com/a/chromium.org/d/msg/blink-dev/Ez2cuT0KmQo/eUpSsU-uAgAJ">Shadow DOM v1</a>
の場合）</p>
<p>「機能を実装する意思があること」を ML 上で宣言します。この ML は他のブラウザベンダの人たちも見ていて意見を交換することもあります。実装することが本当に
Web のためになるのか？他のブラウザベンダの状況・実装の方針はどうか？などを話し合います。</p>
</li>
<li>
<p>実装する</p>
<p>実装に時間がかる大きめな機能は、ランタイムフラグを使用して機能を「デフォルトではオフ」の状態で開発を進めます。</p>
</li>
<li>
<p>公開 ML (blink-dev) に &quot;Intent to ship: XXX&quot; メールを出す (例:
<a href="https://groups.google.com/a/chromium.org/d/msg/blink-dev/zrZRD2ls5tw/ibbjD3cQAQAJ">Shadow DOM v1</a>
の場合)</p>
<p>ship (シップ) というのは、実際にその機能をデフォルトで有効にすることを指します。ランタイムフラグで用いて開発を進めていた場合は、ランタイムフラグを「オン」にするだけです。 ship には 3 人以上の API Owners からの LGTM が必要です。</p>
</li>
</ol>
<h2 id="web-api-1"><a class="self-link" href="#web-api-1">既存の機能の削除 / 既存の Web API をプラットフォームから削除する</a></h2>
<p>「あたらしい API を追加する」のと同じくらいプラットフォームにとって大事なことは「現在すでに使用されている API をプラットフォームから削除する」ことです。特に
Web プラットフォームでは多くの Web サイトが「分散」しており、プラットフォームの作成者が直接コントロールできるわけではありません。「削除」はとても大変な道のりになりがちです。</p>
<div class="article-info">
Google は内部で「単一レポジトリ」を採用しているのは有名な話です。この場合は API の名前の変更などは全部まとめて「リネーム」するひとつのパッチをアトミックにコミットすれば変更が可能です。これは単一レポジトリの大きな利点です。
<p>Web プラットフォームではこの戦略が使えません。どうしても伝わるまで時間がかかってしまいます。</p>
</div>
<p>既存の機能を削除する基本的な流れは以下のようになります。</p>
<ol>
<li>
<p>公開 ML (blink-dev) に &quot;Intent to deprecate: XXX&quot; メールを出す（例:
<a href="https://groups.google.com/a/chromium.org/forum/#!msg/blink-dev/68qSZM5QMRQ/pT2YCqZSomAJ">/deep/</a>
の場合)</p>
<p>「XXX 機能を非推奨にする」と宣言します。あくまで非推奨にするだけでこの時点では削除されません。 Web 開発者が非推奨となった API を使用した場合、DevTool の
Console 上に警告メッセージがでることでしょう。</p>
</li>
<li>
<p>使用率が下がるのをまつ</p>
<p>個々の機能・API の実際の Web における使用率をトラッキングしています (例:
<a href="https://www.chromestatus.com/metrics/feature/timeline/popularity/1375">/deep/ and ::shadow</a>
の場合)。一定のしきい値を下回るまで待ちます。</p>
</li>
<li>
<p>公開 ML (blink-dev) に &quot;Intent to remove: XXX&quot; メールを出す (例:
<a href="https://groups.google.com/a/chromium.org/forum/#!topic/blink-dev/HX5Y8Ykr5Ns">/deep/</a>
の場合)。</p>
<p>実際に削除することを宣言します。LGTM が必要です。</p>
</li>
</ol>
<p>これらはあくまで基本的なルールにすぎません。実際は各ケースに応じて柔軟に判断することが多いです。なにより大事なのは Web サイトのオーナーとのコミュニケーションです。</p>
<h1 id="a-3"><a class="self-link" href="#a-3">開発ツール・インフラ</a></h1>
<p>Chrome の開発はそのスケールのため、既存のツールをそのまま使用するのが難しいケースが多いです。そのため独自に発展した開発インフラを一部に使用しています。GitHub
上で PR を送るといったスタイルではありません。</p>
<p>開発インフラについては過去の記事などでも説明されていますので、ここではコメントとともに軽く触れます。</p>
<h2 id="cl"><a class="self-link" href="#cl">CL</a></h2>
<p>Chrome ではパッチなどのコミットの単位を CL (Change List: チェンジリスト)と呼んでいます。これはもともと Google 内部のバージョン管理システムで使用されていた用語であり、そのまま伝統的に使用されています。</p>
<h2 id="a-4"><a class="self-link" href="#a-4">ビルド</a></h2>
<p><a href="https://chromium.googlesource.com/chromium/src/+/master/tools/gn/README.md">GN</a>
と <a href="https://ninja-build.org/">Ninja</a> を使用しています。 Ninja のほうは最近は
Chrome 以外の他のプロジェクトでも使用されることが増えてきましたね。</p>
<h2 id="a-5"><a class="self-link" href="#a-5">クラウドコンパイル</a></h2>
<p>Chrome はコンパイル対象のファイルが数万あります。普通にビルドするとかなりの時間がかかるでしょう。</p>
<p>Google の人は Goma (クラウド分散コンパイル)のインフラを使用することができます。私の環境だと &quot;-j 1024&quot;（並列度: 1024) のフルビルドで 3 分ほどです。インクリメンタルビルドだと 10 秒以下です。</p>
<p>Opera の人たちは社内で分散コンパイルのインフラ (distcc) を使用しているそうです。</p>
<h2 id="a-6"><a class="self-link" href="#a-6">開発環境</a></h2>
<p>Linux 上で開発している人が多いです。Windows 上の Visual Studio で開発している人もいます。</p>
<h2 id="a-7"><a class="self-link" href="#a-7">デバッグ</a></h2>
<p>gdb や print デバッグなどが主流です。Windows を使う人の主な理由は、Visual Studio
上でデバッグできることだそうです。そのほか、<a href="http://valgrind.org/">valgrind</a>、<a href="https://github.com/google/sanitizers/wiki/AddressSanitizer">ASAN</a>
(AddressSanitizer) なども使用しています。</p>
<h2 id="git"><a class="self-link" href="#git">バージョン管理: Git</a></h2>
<p>Git を使用していますが、直接リモートレポジトリに push することはありません。コミットキュー経由でコミットします。コミットのヒストリーは直線です。</p>
<p>ブランチはリリースブランチを除いて基本的に使用しません。</p>
<p>もちろん各開発者はローカルでは git のブランチを使用します。それぞれの CL ごとにローカルではブランチをつくります。<code>git merge</code>、<code>git rebase</code> などもローカルでは行いますが、サーバ上のブランチにたいして行うことはまずありません。</p>
<h2 id="bug-tracking"><a class="self-link" href="#bug-tracking">Bug Tracking</a></h2>
<p>Chrome のバグは <a href="https://crbug.com/">crbug.com</a> で管理されています。誰でもバグの報告が行えます。「Chrome のバグ？」と思える挙動にであったときはここで検索しましょう。</p>
<h2 id="a-8"><a class="self-link" href="#a-8">レビュー</a></h2>
<p>レビューは <a href="https://chromium-review.googlesource.com/">Gerrit</a> を使用しています。</p>
<h1 id="a-9"><a class="self-link" href="#a-9">ソフトウェアエンジニアリング / 実践しているプラクティス</a></h1>
<p>Chrome の開発に必要な「スキル」は C++ 力、キレイなコードを書く能力、技術的コミュニケーション力、レビュー力など、ソフトウェアエンジニアとしての基本的な力があれば十分でしょう。</p>
<p>最初はよいメンターやレビューアーに恵まれることも大事です。</p>
<p>以下は一般的ではないかもしれませんが Chrome の開発文化で採用されている「よいプラクティス」です。</p>
<h2 id="always-on-tot"><a class="self-link" href="#always-on-tot">Always on ToT (常に先端に載っておく）</a></h2>
<p>ToT とは 「Tip of Tree」の略で、メインブランチの先端のことを指します。リリースに対する緊急 Fix などを除いては、通常のコミットは常に ToT に対して行います。</p>
<p>Chrome のようにコミットが多いプロジェクト (1 日あたり数百) では、新機能の開発を下手にサーバ側でブランチを切って ToT 以外で行ってしまうと、さまざまなデメリットがあります。</p>
<ul>
<li>
<p>「このブランチ一生マージできないのでは」問題。</p>
</li>
<li>
<p>ToT ブランチ上で起きているさまざまなリファクタリングの恩恵を受けることができなくなります。ToT で開発を続けているなら、他の開発者が自分の担当している箇所もどんどん変更していってくれますが、別ブランチを切ると全部自分で面倒を見なければいけません。</p>
</li>
</ul>
<p>これらのデメリットがあるためサーバ側でブランチをきることはほぼありません。そのかわり無効にしておきたい開発中の機能などはランタイムフラグを使用してデフォルトではオフにしておきながら開発を進めます。</p>
<p>矛盾に聞こえるかもしれませんが、「Always on ToT」 は大規模なソフトウェアプロジェクトだからこそ重要であり、最近は、多くのプロジェクトで特にブランチを切ることなく、常にメインブランチに対して開発を進める方法が主流になっていると思います。</p>
<h2 id="a-10"><a class="self-link" href="#a-10">炭鉱のカナリア</a></h2>
<p>Chrome は Canary、Dev、Stable の 3 つのチャネルがあります。 Canary 版とはいわゆる「ナイトリービルド」であり、小鳥の「カナリア」から名前がつけられています。昔は炭鉱などの危険な場所にはカナリアの入った鳥かごをもっていったそうです。カナリアは人間よりも有毒ガスに敏感であるため危険を早期に察知できます。 Chrome も多くの人が使用する Stable 版まで「被害」が及ぶまえに Canary 版で早期に危険を察知するようにしています。</p>
<h2 id="a-11"><a class="self-link" href="#a-11">短いリリースサイクル</a></h2>
<p>Chrome はほぼ 6 週間ごとに Stable 版をリリースするという比較的短いリリースサイクルです。</p>
<p>このモデルは Chrome のみならず最近多くのソフトウェアプロジェクトで取り入られるようになりました。 Rust のようなプログラミング言語でもこのリリースモデルを採用しています。</p>
<p>リリースサイクルが短いことのメリットのひとつは開発者に与える心理です。「どうしてもこのマイルストーンに間に合わせたい！」と無理をすることがなくなります。「このマイルストーンを逃したとしてもまあ次は 6 週間後だから。そんなに大した問題ではない」と考えることができるようになります。</p>
<h2 id="a-12"><a class="self-link" href="#a-12">ビルドの再現性</a></h2>
<p>ビルドの再現性を高めるために、なるべく開発ツールそのものも Chrome の関連レポジトリに一式いれるようにしています。たとえば、clang (C++ コンパイラ）自身もレポジトリに入っており、それをチェックアウトして使用します。</p>
<h2 id="presubmit"><a class="self-link" href="#presubmit">presubmit チェック / コーディングスタイル / コードフォーマットツール</a></h2>
<p>CL をレビューに送る前に、さまざまな presubmit チェックを行うスクリプトが走ります。ソースコードのスタイルもチェック対象のひとつです。</p>
<p>Chromium では C++ については以下のスタイルガイドにそってチェックが行われます。</p>
<ul>
<li><a href="https://chromium.googlesource.com/chromium/src/+/master/styleguide/c++/c++.md">Chromium C++ style guide</a></li>
</ul>
<p>また、<code>clang-format</code> というソースコードフォーマットツールとそのプロジェクト設定ファイルもレポジトリに含まれています。ルールとして「clang-format でフォーマットされたコードのスタイルに対しては、レビューアーは一切文句をいってはいけません」があります。これにはデメリットもありますが、なによりレビュー上で起きがちな無駄なコミュニケーションコストを大幅に削減できるというメリットのほうがプロジェクト全体では大きいと思います。</p>
<h2 id="owner"><a class="self-link" href="#owner">Owner システム</a></h2>
<p>レビューでは CL の修正箇所に応じた 「Owner」 から LGTM を受ける必要があります。
Owner は各フォルダの OWNERS ファイルに記載されています（例:
<a href="https://chromium.googlesource.com/chromium/src/+/master/third_party/WebKit/Source/core/dom/OWNERS">core/dom/OWNERS</a>）。 Owner システムはもともとは Google 内部で使用されていた仕組みですが、最近はいろいろな大規模プロジェクトにも輸出されていますね。</p>
<h2 id="a-13"><a class="self-link" href="#a-13">テスト</a></h2>
<ul>
<li>C++ で書くユニットテスト (<a href="https://github.com/google/googletest">Google Test</a>
を使用）</li>
<li><a href="https://chromium.googlesource.com/chromium/src/+/master/docs/testing/layout_tests.md">Layout Tests</a>:
エンジンの挙動のリグレッションテスト</li>
<li><a href="https://chromium.googlesource.com/chromium/src/+/master/docs/testing/web_platform_tests.md">Web Platform Test</a>:
ブラウザベンダ間で共有されるテスト</li>
<li><a href="https://chromium.googlesource.com/chromium/src/+/lkcr/docs/speed/benchmark_harnesses/blink_perf.md">パフォーマンステスト</a>:
パフォーマンスのリグレッションテスト</li>
</ul>
<p>等があります。それぞれ役割が異なるので使い分けましょう。挙動を変える CL ではまず間違いなくテストを書くことが求められます。</p>
<h2 id="bots-ci"><a class="self-link" href="#bots-ci">Bots (ボット) / CI (継続的インテグレーション)</a></h2>
<p>Chrome は Windows、Linux、Mac、Android の各バージョン、さらにそれぞれについて 32
bit, 64 bit など多くのプラットフォームをサポートしています。それぞれのプラットフォームごとに専用 Bot がいて、継続的インテグレーションテストをしています。</p>
<p><img src="./waterfall.png" alt="waterfall" /></p>
<p>ビルド・継続的インテグレーションテストはさまざまなステップがあり時間がかかります。そのため Chrome の 1 コミットごとに 1 サイクルを回すことができません。通常 1
サイクルには複数のコミットが含まれます。</p>
<p>コミットする前の CL に対しても Bots は利用できます。開発者は作成中の CL を「Try
Bots に投げる」だけで自分の CL に対して全プラットフォーム上でビルド・テストが通るかを確認できます。</p>
<h2 id="sherriff"><a class="self-link" href="#sherriff">Sherriff (シェリフ: 保安官)</a></h2>
<p>Googler かつ Chromium のコミッターの人は、ビルドの不具合やメモリやパフォーマンスのリグレッションなどを見張る仕事を当番制で行っています。この仕事のことを シェリフ（保安官） と呼んでいます。</p>
<p>ビルドの失敗やリグレッションの解決は、時間がたてばたつほど難しくなります。またどうしても機械的には判断できない場面があります。そのため問題を早期に解決するファーストアクションの責任を当番制で分担しています。シェリフの種類にもよりますが、2 クォーターごとに 1 回（2 日）ほどの頻度です。</p>
<p>Chrome の開発は世界中で 24 時間おこなわれているため、シェリフはそれぞれのタイムゾーンことに存在します。</p>
<h2 id="fuzzer"><a class="self-link" href="#fuzzer">Fuzzer</a></h2>
<p>Fuzzer がどういうものか理解するには実際の例を見るのが早いでしょう。</p>
<pre><code class="language-html prettyprint">&lt;!DOCTYPE html&gt;
&lt;html xmlns=&quot;http://www.w3.org/1999/xhtml&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;&gt;
&lt;style type=&quot;text/css&quot;&gt;
*{background-repeat:no-repeat;-webkit-animation-play-state:inherit;max-width:initial;pointer-events:visiblePainted;text-underline-mode:continuous;-webkit-animation-timing-function:initial;outline-style:solid;background-origin:padding;image-rendering:-webkit-positioned;font-size:xx-small;}
.CLASS0{box-pack:end;text-decoration:blue dotted;background-position-x:center;mask:inherit;-webkit-appearance:inherit;border:inherit !important;border-top:outset #824098;counter-reset:counter_4 000000000000000000000000000000002480000000000000000;-webkit-border-before-color:silver;column-width:-webkit-calc(7in);}
.CLASS1{-webkit-writing-mode:lr;min-width:0000184467440737095516230000em;border-right-style:solid;background-position-y:bottom;display:list-item;line-height:inherit;-webkit-nbsp-mode:space;float:none;transition-duration:7.8ms;visibility:inherit;}
.CLASS2{outline-width:medium;position:running(element_3);-webkit-appearance:normal;line-stacking-ruby:include-ruby;-webkit-column-break-inside:avoid;-webkit-column-count:auto;caption-side:top;text-align:justify &quot;R*hg8jb\\&amp;=C75%OIAn:f;3dC[J 4\DQ=/O8\\/\AQU}4;,Ib9n,#xY4@\A e7pQWQ$ejn\90/\(Qer._ wg\)\)qM\9tSdIS,:LoeqW#Uo&lt;&amp;C,=u4Qj'-&lt;vHa.KH2,\\{'[?&quot;;counter-increment:none;counter-reset:counter_1;}
.CLASS3{font-variant:inherit;text-line-through-mode:skip-white-space;-webkit-animation-timing-function:step-end;font:icon;word-wrap:inherit;display:inherit;-webkit-wrap-through:wrap;text-align:inherit;pointer-events:visibleStroke;background-repeat:no-repeat;}
.CLASS4{-webkit-columns:auto 32768;content:inhibit;clear:none !important;margin-top:inherit;left:0.0000000004656612871205812690186753891551357104061636960068426561%;counter-reset:counter_2;column-rule-style:dotted;-webkit-column-span:1;transform-origin:3.5% bottom;vertical-align:text-bottom;}
.CLASS5{-webkit-animation-fill-mode:running;-webkit-overflow-scrolling:inherit;-webkit-transform-style:initial;-webkit-hyphens:manual;font-size:inherit;font-weight:300;word-break:break-all;font:status-bar;right:read-only;background-size:visual;}
.CLASS6{list-style-position:initial;-webkit-overflow-scrolling:inherit;-webkit-animation-play-state:running;background-clip:content-box;background-origin:border-box;border-image:inherit;-webkit-text-emphasis-position:over;-webkit-font-smoothing:antialiased;-webkit-animation-timing-function:ease-in-out;-webkit-line-align:edges;}
.CLASS7{-webkit-font-variant-ligatures:historical-ligatures;-webkit-appearance:searchfield;-webkit-font-feature-settings:on;-webkit-transform-style:preserve-3d;-webkit-border-fit:inherit;-webkit-transition-timing-function:ease-in;font-stretch:inherit;-webkit-line-box-contain:inherit;left:fast;right:slide;}
.CLASS8{clear:right;hyphenate-character:auto;animation:9s;counter-increment:none;outline-style:inherit;-webkit-appearance:inherit;pointer-events:visibleFill;background-repeat:repeat-x;-webkit-animation-timing-function:ease;visibility:hidden;}
.CLASS9{-webkit-user-modify:read-write;-webkit-transition-delay:-9.7ms;padding-top:3.0%;top:112.6376286521287823916281922720372676849365234375px;margin:4.26814254151829697292441778699867427349090576171875% !important;counter-increment:none;-webkit-border-image:none 0.0000610356958614947697804378745622955193539382889866828918457031 round;overflow-x:auto;border-bottom:dotted;counter-reset:none;}
.CLASS10{list-style-type:ethiopic-halehame-ti-er;-webkit-line-box-contain:inherit;border-image:initial;visibility:always;background-size:inherit;clear:inherit;cursor:row-resize;font-stretch:wider;font-weight:300;image-rendering:optimizeQuality;}
.CLASS11{-webkit-font-smoothing:inherit;background-size:contain;right:alternate;-webkit-font-feature-settings:inherit;vertical-align:text-top;border-image:inherit;text-align:initial;text-overflow:clip;background-clip:border;visibility:column-reverse;}
.CLASS12{zoom:document;font-stretch:narrower;background-size:visual;background-origin:border;-webkit-text-emphasis-position:inherit;text-line-through-mode:continuous;-webkit-font-variant-ligatures:no-discretionary-ligatures;-webkit-overflow-scrolling:touch;-webkit-hyphenate-limit-lines:initial;text-align:initial;}
.CLASS13{background-repeat:repeat;-webkit-hyphens:inherit;list-style-position:outside;font-stretch:serif;-webkit-transform-style:initial;-webkit-line-box-contain:inline-box;font-size:smaller;text-overline-mode:skip-white-space;-webkit-font-variant-ligatures:common-ligatures;background-size:inherit;}
.CLASS14{text-overflow:discard;-webkit-text-emphasis-position:initial;direction:inherit;-webkit-animation-timing-function:step-end;-webkit-font-feature-settings:inherit;background-clip:padding;-webkit-transition-timing-function:ease-out;right:slow;-webkit-text-orientation:upright;font-weight:inherit;}
*:target{vertical-align:top;counter-increment:none;text-autospace:ideograph-alpha ideograph-parenthesis;padding:0%;fill:inherit;counter-reset:counter_0;display:inline-table;-webkit-color-correction:sRGB;width:-webkit-min(+9.7mm,-6.9gr);text-decoration:blink;}
.CLASS0:visited{display:inline &quot; &quot; ;-webkit-column-span:1;text-rendering:auto;-webkit-mask-size:contain;column-rule-style:dotted;list-style-position:inherit;backface-visibility:visible;min-height:000000000000000000000000000000002.35445494484197936913005833048373460769653320312500000000000000000000000000000000%;border:inherit #DdCf10;stroke-miterlimit:inherit;}
.CLASS1:valid{border-image:inherit;list-style-position:inherit;-webkit-filter:inherit;-webkit-region-overflow:initial;font-size:smaller;-webkit-text-emphasis-position:initial;background-repeat:repeat;display:compact;text-align:initial;image-rendering:-webkit-optimize-contrast;}
.CLASS2::outside(3){-webkit-line-clamp:0%;vertical-align:1px;box-direction:normal;column-span:all;-webkit-line-box-contain:block;-webkit-border-radius:1%;border:inherit inherit Background;-webkit-animation-iteration-count:3.3;-webkit-border-top-left-radius:0000000000000000000000000000000085899345929% 4.134128640439836743780688266269862651824951171875em;text-wrap:none;}
.CLASS3:above-level{-ms-transform-origin:min(6in,3.6rem);outline-style:inherit;margin-top:inherit;-webkit-box-flex-group:0.58194816685618488971698525347164832055568695068359375;height:8.3vh;glyph-orientation-vertical:1.2grad;-webkit-text-decorations-in-effect:underline line-through blink;-webkit-column-span:1;-webkit-border-start-style:solid;outline:inherit;}
.CLASS4:read-only{text-underline-mode:initial;font-weight:normal;border-image:initial;font:initial;-webkit-region-overflow:break;right:alternate;-webkit-hyphenate-limit-lines:inherit;-webkit-transform-style:preserve-3d;font-stretch:expanded;-webkit-line-box-contain:inherit;}
.CLASS5::footnote-marker{font-size:xx-small;text-line-through-mode:continuous;-webkit-text-emphasis-style:triangle;-webkit-overflow-scrolling:initial;background-clip:border-box;border-image:inherit;list-style-type:malayalam;-webkit-animation-timing-function:step-start;visibility:ahead;text-align:center;}
.CLASS6:lang(nl-nl){color-rendering:optimizeSpeed;-webkit-column-count:0;-webkit-nbsp-mode:normal;-webkit-margin-collapse:inherit discard;marquee-style:alternate;-webkit-mask-repeat-y:no-repeat;nav-down:auto;target-position:behind;opacity:inherit;content:none;}
.CLASS7::outside(2) ::selection{image-rendering:evenodd;text-rendering:exact;cursor:w-resize;word-wrap:break-word;-webkit-animation-fill-mode:initial;border-image:initial;-webkit-wrap-through:initial;-webkit-appearance:progress-bar;font-weight:bolder;-webkit-transform-style:flat;}
.CLASS8::outside(2){-webkit-transform-style:preserve-3d;visibility:avoid;-webkit-animation-play-state:running;background-clip:border;-webkit-text-emphasis-style:farthest-corner;-webkit-hyphens:initial;text-align:-webkit-right;cursor:initial;-webkit-overflow-scrolling:inherit;list-style-type:ethiopic-halehame-aa-et;}
.CLASS9:above-level{left:read-only;-webkit-animation-timing-function:linear;text-underline-mode:skip-white-space;-webkit-overflow-scrolling:initial;outline-style:inherit;-webkit-font-variant-ligatures:discretionary-ligatures;text-line-through-mode:continuous;-webkit-animation-direction:initial;background-repeat:repeat-x;-webkit-line-box-contain:initial;}
.CLASS10::marker{vertical-align:super;-webkit-animation-play-state:running;-webkit-background-composite:initial;background-clip:border-box;font-variant:small-caps;-webkit-transform-style:flat;-webkit-border-fit:lines;min-width:intrinsic;-webkit-hyphens:initial;text-overflow:ellipsis;}
.CLASS11::footnote-marker{text-align:-webkit-match-parent;-webkit-font-smoothing:initial;text-transform:uppercase;-webkit-animation-timing-function:step-end;text-line-through-mode:continuous;text-overline-mode:continuous;font:small-caption;-webkit-text-emphasis-style:triangle;background-size:visual;-webkit-wrap-through:inherit;}
.CLASS12:below-level{-webkit-hyphens:initial;font-size:inherit;-webkit-line-box-contain:replaced;text-overflow:initial;list-style-position:outside;-webkit-wrap-through:wrap;-webkit-background-composite:destination-out;-webkit-animation-play-state:inherit;image-rendering:initial;-webkit-animation-direction:initial;}
.CLASS13:read-only{-webkit-transform-style:flat;-webkit-filter:inherit;text-rendering:economy;width:min-intrinsic;text-align:-webkit-auto;-webkit-animation-timing-function:ease-out;cursor:wait;outline-style:solid;max-width:initial;list-style-position:outside;}
.CLASS14::marker{font-style:inherit;-webkit-border-fit:lines;-webkit-background-composite:clear;text-overflow:initial;background-size:initial;-webkit-region-overflow:initial;-webkit-filter:inherit;outline-style:none;-webkit-animation-fill-mode:initial;-webkit-overflow-scrolling:inherit;}

&lt;/style&gt;
&lt;head dir=&quot;ltr&quot;&gt;
&lt;object title=&quot;AxBxC B&quot; dir=&quot;ltr&quot;&gt;
&lt;kbd class=&quot;CLASS3 CLASS8&quot; title=&quot;c&quot; dir=&quot;ltr&quot;&gt;
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
&lt;/kbd&gt;
&lt;ruby class=&quot;CLASS12&quot; xml:space=&quot;preserve&quot;&gt;
&lt;rb class=&quot;CLASS12&quot; xml:space=&quot;preserve&quot; title=&quot;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA AxBxC&quot;&gt;
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
&lt;/rb&gt;
&lt;rtc class=&quot;CLASS11 CLASS1&quot; xml:space=&quot;preserve&quot; xml:lang=&quot;en&quot;&gt;
&lt;rt class=&quot;CLASS7 CLASS3&quot; xml:lang=&quot;en&quot; rbspan=&quot;1&quot;&gt;
&lt;select class=&quot;CLASS8 CLASS13&quot; title=&quot;b&quot; multiple=&quot;multiple&quot;&gt;
&lt;option class=&quot;CLASS2&quot; dir=&quot;rtl&quot;&gt;
AxBxC AxBxC
&lt;/option&gt;
&lt;/select&gt;
&lt;/rt&gt;
&lt;/rtc&gt;
&lt;/ruby&gt;
&lt;/object&gt;
&lt;/head&gt;
&lt;body class=&quot;CLASS8 CLASS7&quot; xml:space=&quot;preserve&quot;&gt;
&lt;table class=&quot;CLASS9 CLASS3&quot; xml:lang=&quot;nl&quot; frame=&quot;hsides&quot;&gt;
&lt;caption class=&quot;CLASS4 CLASS9&quot; title=&quot;C b&quot; xml:lang=&quot;nl&quot;&gt;
AxBxC AxBxC
&lt;/caption&gt;
&lt;col class=&quot;CLASS4&quot; title=&quot;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&quot; dir=&quot;rtl&quot;/&gt;
&lt;tbody class=&quot;CLASS11 CLASS10&quot; xml:space=&quot;preserve&quot; xml:lang=&quot;en&quot;&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;script type=&quot;text/javascript&quot; xml:space=&quot;preserve&quot;&gt;
var aoScriptElements = document.getElementsByTagName(&quot;script&quot;);
for(var i = 0; i &lt; aoScriptElements.length; i++) {
  aoScriptElements[i].parentNode.removeChild(aoScriptElements[i]);
}
if(window.layoutTestController){
  layoutTestController.waitUntilDone();
  layoutTestController.setCanOpenWindows(true);
}
function cleanup() {
  var iCleanup = setInterval(function(){
    var oe = document.getElementsByTagName(&quot;*&quot;);
    if (oe.length &lt;= 1) {
      clearInterval(iCleanup);
      try{(opener || top).done()}catch(e){}
      if(window.layoutTestController)layoutTestController.notifyDone();
      return;
    }
    for (var i = 0; i &lt; oe.length; i++) {
      var o = oe.item(i);
      if (!o.firstElementChild &amp;&amp; o != document.documentElement) {
        o.offsetTop;
        var c = o, p = o.parentNode;
        try{p.replaceChild(document.createTextNode(&quot;&lt;&quot;+o.tagName+&quot;&gt;&quot;+o.textContent+&quot;&lt;/&quot;+o.tagName+&quot;&gt;&quot;), o)}
        catch(e){}
      }
    }
    window.resizeBy(1,1);
  }, 100);
}
var event_handler_C3_webkitAnimationStart_active = false;
var event_handler_C3_webkitAnimationStart_fired_count = 0;
function event_handler_C3_webkitAnimationStart() {
  if (event_handler_C3_webkitAnimationStart_active) return ;
  event_handler_C3_webkitAnimationStart_fired_count++;
  if (event_handler_C3_webkitAnimationStart_fired_count &gt;= 20) return;
  event_handler_C3_webkitAnimationStart_active = true;
  var oElement = event.srcElement;
  var oSelection=window.getSelection();
  if (!oSelection.rangeCount) {
  document.execCommand(&quot;SelectAll&quot;, false, false)
  }
  try{oSelection.modify('move', 'backward', 'paragraph')}
  catch(e){}
  var oSelection=window.getSelection();
  if (!oSelection.rangeCount) {
  document.execCommand(&quot;SelectAll&quot;, false, false)
  }
  var oRange = oSelection.rangeCount ? oSelection.getRangeAt(78 % oSelection.rangeCount) : null;
  if (oRange) oSelection.addRange(oRange.cloneRange());
  var oRange = oSelection.rangeCount ? oSelection.getRangeAt(27 % oSelection.rangeCount) : null;
  if (oRange) oRange.detach();
  try{oSelection.deleteFromDocument()}
  catch(e){}
  var oSelection=window.getSelection();
  if (!oSelection.rangeCount) {
  document.execCommand(&quot;SelectAll&quot;, false, false)
  }
  var oRange = oSelection.rangeCount ? oSelection.getRangeAt(72 % oSelection.rangeCount) : null;
  if (oRange) oRange.detach();
  try{oSelection.deleteFromDocument()}
  catch(e){}
  document.execCommand('RemoveFormat',false,false);
  var oSelection=window.getSelection();
  if (!oSelection.rangeCount) {
  document.execCommand(&quot;SelectAll&quot;, false, false)
  }
  try{oSelection.collapseToEnd()}
  catch(e){}
  try{oSelection.modify('move', 'forward', 'lineboundary')}
  catch(e){}
  var oRange = oSelection.rangeCount ? oSelection.getRangeAt(46 % oSelection.rangeCount) : null;
  if (oRange) {
    var oInsertedElement = (function(){
    var aoElements = document.getElementsByTagName(&quot;*&quot;);
    if (aoElements.length) return aoElements[57 % aoElements.length];
    var oNewElement = document.createElementNS('http://www.w3.org/2000/svg', 'feBlend');
    if (oNewElement) {
      try{document.appendChild(oNewElement)}
      catch(e){}
    }
    return oNewElement;
  })();
    if (oInsertedElement) {
      try{oRange.insertNode(oInsertedElement)}
  catch(e){}
    }
  }
  event_handler_C3_webkitAnimationStart_active = false;
}
document.addEventListener(&quot;webkitAnimationStart&quot;, event_handler_C3_webkitAnimationStart, true);
var event_handler_C4_DOMFocusIn_active = false;
var event_handler_C4_DOMFocusIn_fired_count = 0;
</code></pre>
<p>このような一見「ランダム」な HTML・JavaScript をひたすら生成して、ブラウザがクラッシュする入力を見つけるプログラムのことを Fuzzer といい、そのテクニックを
<a href="https://en.wikipedia.org/wiki/Fuzzing">Fuzzing</a> といいます。</p>
<p>このようにランダムに生成するだけで、ブラウザがクラッシュするような HTML が本当に見つかるかどうか疑問に思われるかもしれませんが、ものの見事に人間ではまず思いもつかないような HTML を生成してエンジンの秘孔をついてくることがあり、ブラウザのセキュリティ・安定性向上のため役にたっています。Chromium プロジェクトではクラスタ上で Fuzzer を走らせており (ClusterFuzz)、クラッシュが見つかるたびにバグが自動的にファイルされます。</p>
<p>また Fuzzing は最近では外部の攻撃者やセキュリティ研究者が脆弱性を発見する補助ツールとしても使用されています。たとえば昨年の例ですが世界的に有名なポーランドのセキュリティ研究者 Mariusz Mlynski が報告してきた Universal XSS 脆弱性 はもともとは Fuzzing で見つけたクラッシュを利用しており、まさに秘孔をついてきました。</p>
<p>興味のある方は
<a href="https://bugs.chromium.org/p/chromium/issues/detail?id=630870">crbug.com/630870</a>
を参照してください。報告者と私の間での生々しいやり取りが見れます。この脆弱性発見の報告には、賞金 $7,500 が支払われました。もちろん直した私には 1 ドルもでません。:)</p>
<h2 id="okrs"><a class="self-link" href="#okrs">OKRs</a></h2>
<p>OKRs は最近は Google の外でも有名になりました。Chrome でも各チームは Quarter ごとに OKR を設定しています。私は DOM / HTML Team の OKRs を設定しています。</p>
<h2 id="a-14"><a class="self-link" href="#a-14">やっていないこと / ほとんど流行っていないこと / そんな言葉はだれも使っていない</a></h2>
<ul>
<li>
<p>ペアプログラミング</p>
<p>日常的にやっている人はみたことがありません。「ペアプログラミングのかわり」としての「レビュー」はこの業界でほぼ定着しましたが、その一方ペアプログラミングはほぼ絶滅していると思います。</p>
<p>「ペアプログラミングを導入しましょう」というととおそらく 9 割以上の人が反対すると思いますが、逆に「レビューを廃止しましょう」というと賛成する人は 1 割もいないでしょう。</p>
</li>
</ul>
<ul>
<li>
<p>テスト駆動開発</p>
<p>テストを書くのは大事ですが「テストだけ」が開発を駆動することはありません。現代はむしろ「レビュー駆動開発」といったほうが多くの人にとってはしっくりくると思います。レビューについてはこのテーマだけで記事が 1 つ、または本が 1 冊書けるほど現代のソフトウェアエンジニアリングにおいて重要ですが、またの機会ということでこの記事では詳細には触れません。</p>
</li>
<li>
<p>オブジェクト指向</p>
<p>よいソフトウェアデザインを追求することは、レビューなどでも指摘する大事な項目のひとつですが、「オブジェクト指向」という言葉がレビューや日常会話で登場することはまずありません。レビューでは具体的に指摘します。</p>
</li>
<li>
<p>DDD (ドメイン駆動設計)</p>
<p>誰もその話題はしていません。</p>
</li>
</ul>
<h1 id="a-15"><a class="self-link" href="#a-15">最後に</a></h1>
<p>Web プラットフォームを支えるソフトウェアエンジニアリングといっても派手なものはありません。正しい「ソフトウェアエンジニアリング」をひたすら積み重ねるという当たり前のことをきちんと行うだけです。その積み重ねが人類の歴史上もっとも広がったエコシステムである「Web プラットフォーム」そしてその実装である「ブラウザ」を支えていることが雰囲気で理解できたかと思います。</p>
<p>このような巨大なスケールのプラットフォーム・ソフトウェアを人間の共同体がまがりなりにも「開発できている」という事実は非常に興味深いですし、人類やエンジニアリングにとっては夢のある話です。</p>

  </div>
</article>


          
          <footer class="base-footer text-center">
            <small>
              <a href="/">Home</a> | &copy; 2005-2018 hayato.io
            </small>
          </footer>
          
        </div>
        
        <div class="d-print-none d-lg-none d-xl-block col-xl-3">
          <nav id="toc" data-toggle="toc">
            <nav class="nav nav-pills flex-column">
<a class="nav-link" href="#web">Web プラットフォーム</a>
<nav class="nav nav-pills flex-column">
<a class="nav-link" href="#web-web-standards">Web 標準 (Web Standards)</a>
<a class="nav-link" href="#browser-vendor">ブラウザベンダ (Browser Vendor)</a>
</nav>
<a class="nav-link" href="#web-web">Web のつくりかた: Web 標準編</a>
<nav class="nav nav-pills flex-column">
<a class="nav-link" href="#dom-standard">DOM Standard</a>
<a class="nav-link" href="#html-standard">HTML Standard</a>
<a class="nav-link" href="#web-1">Web 標準の更新のしかた</a>
<a class="nav-link" href="#wontfix-close-issue">WONTFIX / Close されやすい Issue</a>
<a class="nav-link" href="#a">ブラウザベンダが気にするところ</a>
<a class="nav-link" href="#web-web-plaform-test">Web プラットフォームテスト (Web Plaform Test)</a>
<a class="nav-link" href="#a-1">名前の衝突 / 後方互換製を壊す恐れ</a>
<a class="nav-link" href="#a-2">いつまでたっても実装されない仕様の取り扱い</a>
<a class="nav-link" href="#whatwg">WHATWG</a>
</nav>
<a class="nav-link" href="#web-2">Web のつくりかた: ブラウザ編</a>
<nav class="nav nav-pills flex-column">
<a class="nav-link" href="#web-api">新機能の実装 / 新しい Web API をプラットフォームに追加する</a>
<a class="nav-link" href="#web-api-1">既存の機能の削除 / 既存の Web API をプラットフォームから削除する</a>
</nav>
<a class="nav-link" href="#a-3">開発ツール・インフラ</a>
<nav class="nav nav-pills flex-column">
<a class="nav-link" href="#cl">CL</a>
<a class="nav-link" href="#a-4">ビルド</a>
<a class="nav-link" href="#a-5">クラウドコンパイル</a>
<a class="nav-link" href="#a-6">開発環境</a>
<a class="nav-link" href="#a-7">デバッグ</a>
<a class="nav-link" href="#git">バージョン管理: Git</a>
<a class="nav-link" href="#bug-tracking">Bug Tracking</a>
<a class="nav-link" href="#a-8">レビュー</a>
</nav>
<a class="nav-link" href="#a-9">ソフトウェアエンジニアリング / 実践しているプラクティス</a>
<nav class="nav nav-pills flex-column">
<a class="nav-link" href="#always-on-tot">Always on ToT (常に先端に載っておく）</a>
<a class="nav-link" href="#a-10">炭鉱のカナリア</a>
<a class="nav-link" href="#a-11">短いリリースサイクル</a>
<a class="nav-link" href="#a-12">ビルドの再現性</a>
<a class="nav-link" href="#presubmit">presubmit チェック / コーディングスタイル / コードフォーマットツール</a>
<a class="nav-link" href="#owner">Owner システム</a>
<a class="nav-link" href="#a-13">テスト</a>
<a class="nav-link" href="#bots-ci">Bots (ボット) / CI (継続的インテグレーション)</a>
<a class="nav-link" href="#sherriff">Sherriff (シェリフ: 保安官)</a>
<a class="nav-link" href="#fuzzer">Fuzzer</a>
<a class="nav-link" href="#okrs">OKRs</a>
<a class="nav-link" href="#a-14">やっていないこと / ほとんど流行っていないこと / そんな言葉はだれも使っていない</a>
</nav>
<a class="nav-link" href="#a-15">最後に</a>
</nav>

          </nav>
        </div>
        
      </div>
    </div>
    
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
    <script src="https://cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js"></script>
  </body>
</html>
